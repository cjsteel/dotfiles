setxkbmap \
    -rules evdev \
    -model pc105 \
    -layout hu \
    -option
#    -option lv3:alt_switch -option terminate:ctrl_alt_bksp \
#    -option altwin:swap_lalt_lwin -option altwin:alt_super_win

if [ -f "$HOME/.layout.xkb" ]; then
    xkbcomp $HOME/.layout.xkb $DISPLAY
fi

xset b off

type "synclient" > /dev/null 2>&1 && while :; do
    synclient TapButton1=1
    synclient TapButton2=3
    synclient VertTwoFingerScroll=1
    break
done

if [ -f "$HOME/.Xdefaults" ]; then
    xrdb $HOME/.Xdefaults
fi

for p in $(pidof gnome-screensaver conky trayer skype nm-applet chrome); do
    kill $p
done

type "xscreensaver" > /dev/null 2>&1 && while :; do
    xscreensaver-command -exit
    xscreensaver -no-splash &
    break
done

type "gnome-keyring-daemon" > /dev/null 2>&1 && while :; do
    killall gnome-keyring-daemon
    eval "$(gnome-keyring-daemon -r)"
    export GNOME_KEYRING_CONTROL
    export SSH_AUTH_SOCK
    export GPG_AGENT_INFO
    export GNOME_KEYRING_PID
    break
done

type "trayer" > /dev/null 2>&1 && trayer --widthtype request --align right \
    --height 32 --transparent true --alpha 0 --tint 0x0B0B0B &

type "skype" > /dev/null 2>&1 && PULSE_LATENCY_MSEC=30 skype &

type "dropbox" > /dev/null 2>&1 && (dropbox stop; dropbox start &)

type "nm-applet" > /dev/null 2>&1 && nm-applet &

type "autocutsel" > /dev/null 2>&1 && while :; do
    autocutsel -fork
    autocutsel -s PRIMARY -fork
    break
done

type "firefox" > /dev/null 2>&1 && (sleep 10 && firefox) &

N_SCREENS=$(xrandr|grep '\<connected\>'|wc -l)
for screen in $(seq 1 $N_SCREENS); do
    type "conky" > /dev/null 2>&1 && type "dzen2" > /dev/null 2>&1 && while :; do
        export FG='white'
        export BG='#002b36'
        export FONT='-*-terminus-medium-r-*-*-14-*-*-*-*-*-*-*'
        export LC_ALL=hu_HU.UTF-8
        (sleep 5 && conky -c $HOME/.conkyrc | dzen2 -e - -x '500' -ta r -fg $FG \
            -bg $BG -fn $FONT -xs $screen) &
        break
    done
done
